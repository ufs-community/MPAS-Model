<!-- ========================================================================================================== -->
<!-- MAIN CHEMISTRY REGISTRY:                                                                                    -->
<!-- ========================================================================================================== -->

<!-- **************************************************************************************** -->
<!--           DIMENSIONS             -->
<!-- **************************************************************************************** -->
   <dims>
      <dim name="nChem"              definition="namelist:num_chem"
          description="Number of chemical tracers (nscalar minus nmoist)"/>
      <dim name="nkemit"             definition="namelist:kemit"
          description="Number of vertical levels in anthropogenic emission file"/>
      <dim name="nkfire"             definition="namelist:kfire"
          description="Number of vertical levels in biomass burning emission file"/>
      <dim name="nkbio"             definition="namelist:kbio"
          description="Number of vertical levels in biogenic emission file"/>
      <dim name="nkvol"             definition="namelist:kvol"
          description="Number of vertical levels in volcanic emission file"/>
      <dim name="TWENTYFOUR"          definition="24"
          description="A constant value of 24"/>
   </dims>

<!-- **************************************************************************************** -->
<!-- **************************************  Packages  ************************************** -->
<!-- **************************************************************************************** -->

   <packages>
         <package name="mpas_smoke_in"  description="parameterization of smoke."/>
         <package name="mpas_anthro_in" description="parameterization of anthropogenic emissions for mpas-smoke"/>
         <package name="mpas_aerosols_in" description="parameterization of mpas aerosols"/>
   </packages>


<!-- ============================================================================================================ -->
<!--            CHEMISTRY NAMELIST -->
<!-- ============================================================================================================ -->
   <nml_record name="chemistry" in_defaults="true">
      <nml_option name="config_smoke_scheme" type="character" default_value="off" in_defaults="false"
           units="-"
           description="configuration for mpas smoke model"
           possible_values="`on',`off'"/>
      <nml_option name="config_anthro_scheme" type="character" default_value="off" in_defaults="false"
           units="-"
           description="configuration for mpas anthropogenic emissions model"
           possible_values="`on',`off'"/>
      <nml_option name="num_chem" type="integer" default_value="0"
           units="-"
           description="Number of chemical tracers"
           possible_values="Positive integer values"/>
      <nml_option name="kemit" type="integer" default_value="1"
           units="-"
           description="Number of vertical levels in anthropogenic emission input"
           possible_values="Positive integer values"/>
      <nml_option name="kfire" type="integer" default_value="1"
           units="-"
           description="Number of vertical levels in biomaass burning emission input"
           possible_values="Positive integer values"/>
      <nml_option name="kbio" type="integer" default_value="1"
           units="-"
           description="Number of vertical levels in biogenic emission input"
           possible_values="Positive integer values"/>
      <nml_option name="kvol" type="integer" default_value="1"
           units="-"
           description="Number of vertical levels in volcanic emission input"
           possible_values="Positive integer values"/>
      <nml_option name="hwp_method" type="integer" default_value="1"
           units="-"
           description="Algorithm choice for the hourly wildfire potential"
           possible_values="Positive integer values"/>
      <nml_option name="hwp_alpha" type="real" default_value="1.0"
           units="-"
           description="Scale factor for the hourly wildfire potential"
           possible_values="Positive real values"/>
      <nml_option name="bb_input_prevh" type="integer" default_value="24"
           units="-"
           description="Number of previous hours to average smoke input variables"
           possible_values="factors of 24 (1,2,3,4,6,8,12,24)"/>
      <nml_option name="wetdep_ls_opt" type="integer" default_value="0"
           units="-"
           description="Flag to turn on offline wet deposition"
           possible_values="Positive integer values"/>
      <nml_option name="wetdep_ls_alpha" type="real" default_value="0.0"
           units="-"
           description="Removal fraction for offline wet deposition"
           possible_values="Real values in the range [0,1]"/>
      <nml_option name="plumerise_opt" type="integer" default_value="0"
           units="-"
           description="Algorithm choice for plumerise"
           possible_values="Positive integer values"/>
      <nml_option name="plume_wind_eff" type="integer" default_value="0"
           units="-"
           description="Algorithm choice for wind effects in plumerise"
           possible_values="Positive integer values"/>
      <nml_option name="plume_alpha" type="real" default_value="0.0"
           units="-"
           description="Enrainment constant for plumerise scheme"
           possible_values="Positive integer values"/>
      <nml_option name="ebb_dcycle" type="integer" default_value="0"
           units="-"
           description="Algorithm choice wildfire emission forecast"
           possible_values="Positive integer values"/>
      <nml_option name="add_fire_heat_flux" type="logical" default_value="false" in_defaults="false"
           units="-"
           description="Logical flag to turn on/off fire heat flux to the atmosphere"
           possible_values=".true. or .false."/>
      <nml_option name="add_fire_moist_flux" type="logical" default_value="false" in_defaults="false"
           units="-"
           description="Logical flag to turn on/off fire heat moisture to the atmosphere"
           possible_values=".true. or .false."/>
      <nml_option name="bb_emis_scale_factor" type="real" default_value="1.0"
           units="-"
           description="Scale factor applied to biomass burning fire emissions"
           possible_values="Positive real values"/>
      <nml_option name="drydep_opt" type="integer" default_value="0"
           units="-"
           description="Algorithm choice for dry deposition"
           possible_values="Positive integer values"/>
      <nml_option name="pm_settling" type="integer" default_value="0"
           units="-"
           description="Algorithm choice for particulate matter settling"
           possible_values="Positive integer values"/>
       <nml_option name="dust_alpha" type="real" default_value="1.0"
           units="-"
           description="Scaling (linear) factor for dust emissions"
           possible_values="Positive real values"/>
       <nml_option name="dust_gamma" type="real" default_value="1.0"
           units="-"
           description="Scaling (exponential) factor for sediment supply"
           possible_values="Positive real values"/>
       <nml_option name="dust_moist_correction" type="real" default_value="1.0"
           units="-"
           description="Moisture correction factor for FENGSHA dust"
           possible_values="Positive real values"/>
       <nml_option name="dust_drylimit_factor" type="real" default_value="1.0"
           units="-"
           description="soil moisture dry limit factor for FENGSHA dust"
           possible_values="Positive real values"/>
       <nml_option name="plumerisefire_frq" type="integer" default_value="60" in_defaults="false"
            units="minutes"
            description="frequency of call to fire plumerise"
            possible_values="Positive integer values"/>
   </nml_record>

<!-- **************************************************************************************** -->
<!-- *************************************** Streams **************************************** -->
<!-- **************************************************************************************** -->

   <streams>
      <stream name="output"
              type="output"
              filename_template="history.$Y-$M-$D_$h.$m.$s.nc"
              output_interval="6:00:00"
              runtime_format="separate_file">
              <var name="ddvel"/>
              <var name="wetdep_resolved"/>
              <var name="hwp"/>
              <var name="frp_out"/>
              <var name="fre_out"/>
              <var name="hfx_bb"/>
              <var name="qfx_bb"/>
              <var name="PM2_5"/>
              <var name="PM10"/>
              <var name="max_bb_plume"/>
              <var name="min_bb_plume"/>
              <var name="coef_bb_dc"/>
              <var name="fire_hist"/>
              <var name="fire_peak_hr"/>
              <var name="fire_type"/>
              
              <var_array name="e_bb_out"/>
      </stream>

      <stream name="smoke_retro_input"
         type="input"
         filename_template="smoke.init.retro.$Y-$M-$D_$h.$m.$s.nc"
         filename_interval="input_interval"
         input_interval="1:00:00"
         immutable="true"                        
         in_defaults="false">

         <var_array name="e_bb_in"/>
         <var name="frp_in"/>
         <var name="fre_in"/>
      </stream>

      <stream name="smoke_input"
         type="input"
         filename_template="x1.40962.bb.init.nc"
         input_interval="initial_only"
         immutable="true"                        
         in_defaults="false">

         <var name="hwp_prev24"/>
         <var name="totprcp_prev24"/>
         <var name="frp_prev24"/>
         <var name="fre_prev24"/>
      </stream>

      <stream name="anthro_input"
         type="input"
         filename_template="anthro.init.$Y-$M-$D_$h.$m.$s.nc"
         filename_interval="input_interval"
         input_interval="1:00:00"
         immutable="true"
         in_defaults="false">
     
         <var_array name="e_ant_in"/>
      </stream>

</streams>


<!-- ================================ -->
<!-- TRACERS = GASES + AEROSOLS -->
<!-- ================================ -->
   <var_struct name="state" time_levs="2">
      <var_array name="scalars" type="real" dimensions="nVertLevels nCells Time">
         <var name="smoke_fine" array_group="chemistry" units="kg kg^{-1}"
              description="fine smoke mixing ratio"
              packages="mpas_smoke_in;mpas_anthro_in"/>
      </var_array>
   </var_struct>

<!-- INPUT EMISSIONS -->
   <var_struct name="emis_input" time_levs="1">
     <!-- BIOMASS BURNING -->
      <var_array name="e_bb_in" type="real" dimensions="nkfire nCells Time">
         <var name="e_bb_in_smoke_fine" name_in_code="e_bb_in_smoke_fine" array_group="bb_in_aerosols" units="ug m^{-2} s^{-1}"
              description="input biomass burning fine smoke emissions"
              packages="mpas_smoke_in"/>
      </var_array>
     <!-- Anthropogenic -->
      <var_array name="e_ant_in" type="real" dimensions="nkemit nCells Time">

         <var name="e_ant_in_smoke_fine" name_in_code="e_ant_in_smoke_fine" array_group="ant_in_aerosols" units="ug m^{-2} s^{-1}"
              description="input anthropogenic fine smoke emissions"
              packages="mpas_anthro_in"/>
      </var_array>
   </var_struct>

<!-- Chemistry Diagnostics -->                   
   <var_struct name="diag_physics" time_levs="1">
<!-- OUTPUT EMISSIONS -->
      <var_array name="e_bb_out" type="real" dimensions="nVertLevels nCells Time">
         <var name="e_bb_out_smoke_fine" name_in_code="e_bb_out_smoke_fine" array_group="bb_out_aerosols" units="ug m^{-2} s^{-1}"
              description="output biomass burning fine smoke emissions"
              packages="mpas_smoke_in"/>
      </var_array>

      <var_array name="e_ant_out" type="real" dimensions="nVertLevels nCells Time">
         <var name="e_ant_out_smoke_fine" name_in_code="e_ant_out_smoke_fine" array_group="ant_out_aerosols" units="ug m^{-2} s^{-1}"
              description="output anthropogenic fine smoke emissions"
              packages="mpas_anthro_in"/>
      </var_array>

      <var name="frac_grid_burned" type="real" dimensions="nCells Time" units="-"
           description="fraction of grid cell area burned"
           packages="mpas_smoke_in"/>
      <var name="hfx_bb" type="real" dimensions="nCells Time" units="W m^{-2}"
           description="heat flux from biomass burning"
           packages="mpas_smoke_in"/>
      <var name="qfx_bb" type="real" dimensions="nCells Time" units="kg m^{-2}"
           description="water vapor flux from biomass burning"
           packages="mpas_smoke_in"/>
      <var name="flam_frac" type="real" dimensions="nCells Time" units="-"
           description="fraction of flaming bb emissions"
           packages="mpas_smoke_in"/>
      <var name="min_bb_plume" type="integer" dimensions="nCells Time" units="-"
           description="minimumum biomass burning plumerise injection level"
           packages="mpas_smoke_in"/>
      <var name="max_bb_plume" type="integer" dimensions="nCells Time" units="-"
           description="maximumum biomass burning plumerise injection level"
           packages="mpas_smoke_in"/>
      <var name="fire_type" type="integer" dimensions="nCells Time" units="-"
           description="type of fire"
           packages="mpas_smoke_in"/>
      <var name="fire_peak_hr" type="real" dimensions="nCells Time" units="hr"
           description="peak hour of wildfire"
           packages="mpas_smoke_in"/>
      <var name="fire_hist" type="real" dimensions="nCells Time" units="-"
           description="coefficient to scale the fire activity depending on the fire duration"
           packages="mpas_smoke_in"/>
      <var name="coef_bb_dc" type="real" dimensions="nCells Time" units="-"
           description="coefficient of diurnal cycle of biomass burning emissions"
           packages="mpas_smoke_in"/>
      <var name="frp_in" type="real" dimensions="nCells Time" units="MW"
           description="Input fire radiative power"
           packages="mpas_smoke_in"/>
      <var name="frp_out" type="real" dimensions="nCells Time" units="MW"
           description="Output fire radiative power"
           packages="mpas_smoke_in"/>
      <var name="fre_in" type="real" dimensions="nCells Time" units="MJs"
           description="Input fire radiative energy"
           packages="mpas_smoke_in"/>
      <var name="fre_out" type="real" dimensions="nCells Time" units="MJs"
           description="Output fire radiative energy"
           packages="mpas_smoke_in"/>
      <var name="hwp" type="real" dimensions="nCells Time" units="-"
           description="Hourly Wildfire Potential"
           packages="mpas_smoke_in"/>
      <var name="hwp_prev24" type="real" dimensions="nCells TWENTYFOUR" units="-"
           description="Hourly Wildfire Potential over the last 24 hours"
           packages="mpas_smoke_in"/>
      <var name="frp_prev24" type="real" dimensions="nCells TWENTYFOUR" units="MW"
           description="Fire Radiative Power over the last 24 hours"
           packages="mpas_smoke_in"/>
      <var name="fre_prev24" type="real" dimensions="nCells TWENTYFOUR" units="MJs"
           description="Fire Radiative Energy over the last 24 hours"
           packages="mpas_smoke_in"/>
      <var name="totprcp_prev24" type="real" dimensions="nCells TWENTYFOUR" units="m" 
           description="Total precipitation over the last 24 hours"
           packages="mpas_smoke_in"/>
      <var name="fire_end_hr" type="real" dimensions="nCells Time" units="hr"
           description="Hours since fire was last detected"
           packages="mpas_smoke_in"/>
      <var name="ddvel"                 type="real" dimensions="nChem nCells Time" units="cm s^{-1}"
           description="dry deposition velocitiy"/>
      <var name="wetdep_resolved"       type="real" dimensions="nChem nCells Time" units="ug m^{-2} s^{-1}"
           description="dry deposition velocitiy"/>
      <var name="PM2_5"             type="real" dimensions="nVertLevels nCells Time" units="ug m^{-3}"
           description="particulate matter less than or equal to 2.5 micrometers in diameter"/>
      <var name="PM10"             type="real" dimensions="nVertLevels nCells Time" units="ug m^{-3}"
           description="particulate matter less than or equal to 10 micrometers in diameter"/>
  </var_struct>


<!-- ================================ -->
<!-- TRACER TENDENCIES -->
<!-- ================================ -->
   <var_struct name="tend" time_levs="1">
#ifndef MPAS_CAM_DYCORE
      <var_array name="scalars_tend" type="real" dimensions="nVertLevels nCells Time">
         <var name="tend_smoke_fine" name_in_code="smoke_fine" array_group="chemistry" units="kg m^{-3} s^{-1}"
               description="Tendency of fine smoke mass per unit volume divided by d(zeta)/dz"
               packages="mpas_smoke_in"/>
            </var_array>
#endif
        </var_struct>

<!-- =================================== -->
<!-- TRACER LATERAL BOUNDARY CONDITIONS  -->
<!-- =================================== -->
   <var_struct name="lbc" time_levs="2" packages="limited_area">
      <var_array name="lbc_scalars" type="real" dimensions="nVertLevels nCells Time">
         <var name="lbc_smoke_fine" name_in_code="smoke_fine" array_group="chemistry"  packages="mpas_smoke_in" units="kg kg^{-1} s^{-1}"
              description="Lateral boundary tendency of fine smoke mixing ratio"/>
      </var_array>
   </var_struct>

   <var_struct name="tend_physics" time_levs="1">
           <var  name="tend_chem_settle" type="real" dimensions="nChem nVertLevels nCells Time" units="kg kg^{-1} s^{-1}"
                description="tendency of chemistry due to gravitational settling"/>
   </var_struct>
